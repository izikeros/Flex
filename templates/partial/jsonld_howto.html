{# HowTo Schema for tutorial/howto articles #}
{# Reads HowTo-Steps from:
   1. Article frontmatter (priority)
   2. Content markers extracted by seo_leo_enhancer plugin (fallback)
   
   Frontmatter format:
   Article-Type: howto
   HowTo-Steps:
     - name: Step 1 Title
       text: Description of step 1
       image: /images/step1.png  (optional)
     - name: Step 2 Title
       text: Description of step 2
   
   Content marker format:
   <!-- howto-start -->
   ### Step 1: Install dependencies
   Run pip install...
   <!-- howto-end -->
#}

{% set howto_steps = article.metadata.get('howto-steps') %}
{% if not howto_steps and article.seo_leo %}
{% set howto_steps = article.seo_leo.howto_from_content %}
{% endif %}
{% set is_howto = article.metadata.get('article-type') == 'howto' or howto_steps %}
{% if is_howto and howto_steps %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "HowTo",
  "name": "{{ article.title | escape }}",
  "description": "{{ article.summary | striptags | escape }}",
  {% if article.image %}"image": "{{ SITEURL }}{{ article.image }}",{% endif %}
  "totalTime": "PT{{ article.stats.read_mins | default(5) }}M",
  "step": [
    {% for step in howto_steps %}
    {
      "@type": "HowToStep",
      "position": {{ loop.index }},
      "name": "{{ step.name | escape }}",
      "text": "{{ step.text | escape }}"{% if step.image %},
      "image": "{{ SITEURL }}{{ step.image }}"{% endif %}
    }{% if not loop.last %},{% endif %}
    {% endfor %}
  ]
}
</script>
{% endif %}
